# T-Lite с голосовым вводом и выводом на основе RAG (Кинопоиск)

## Описание проекта

  Данный проект представляет собой диалогового ассистента, интегрирующего голосовые технологии и Retrieval-Augmented Generation (RAG) для работы с данными Кинопоиска. Ассистент принимает текстовые или голосовые запросы, выполняет поиск релевантной информации в базе данных рецензий и фильмов, а затем генерирует ответы с использованием LLM (T-Lite), которые преобразуются в голос.

## Структура проекта

### Голосовые технологии
  Распознавание речи (STT): Используется библиотека GigaAM для распознавания речи, с возможностью экспорта модели в ONNX для ускорения обработки. В целом, на данный момент, по внутренним тестам СберБанка а также внешним тестированиям, является SOTA моделью для STT на русском языке.
  
  Синтез речи (TTS): Применяется модель tts_models/multilingual/multi-dataset/xtts_v2 для генерации естественного звучания. Качество модели: приемлимое, но все же плохо работает с русским языком(произношение режет слух), но, к сожалению, на данный момент я не нашел TTS лучше, поддерживающий русский язык и использования своего wav с голосом(как спикера).


### LLM
  Используется T-lite (версия t-tech/T-lite-it-1.0) для генерации ответов на запросы. 7B модель , за основу которой взята Qwen 2.5 7B, дообученная на 141B русских токенах. В бенчемарках обгоняет RuAdapt-Qwen-7B-Instruct-v1, которая изначально планировалась в качестве LLM для проекта. Хотя эта модель явно избыточна для этой задачи и этого датасета(Вероятно модель и сама училась на этом датасете и в целом неплохо справлялась с вопросами о кино), но RAG смог дать небольшой прирост в точности ответов, например на запросах типа: назови N фильмов с участие актера X. Лучше всего заметно было бы влияние RAG(Кинопоиск) на модели , к примеру, RuAdapt-Qwen-3B, но мне, все таки, хотелось испытать новую модель от Т-Банка , которая по их заявлениям SOTA на русском языке в этой весовой категории(7B).

### Векторное представление данных
  Применяется модель SentenceTransformer (intfloat/multilingual-e5-large) для создания эмбеддингов текстов рецензий.

  Хранение данных организовано в Qdrant, который поддерживает быстрый семантический поиск.

### RAG-подход
  Интеграция поиска релевантных текстов с генерацией ответов.
  
  Переформулирование запросов пользователя для повышения качества поиска.

### Ранжирование документов:
Используется кросс-энкодер (BAAI/bge-reranker-v2-m3) для определения наиболее релевантных текстов.

## Основные функции:
### Голосовой ввод и вывод:
Распознавание запроса пользователя из аудиофайла и генерация голосового ответа.Пример вызова: 

    chat_with_audio_input(query_path="query.wav").
### Текстовый ввод и голосовой вывод:
  Обработка текстовых запросов пользователя и генерация озвученного ответа.Пример вызова: 
  
    chat_without_audio_input(query="Что вы можете сказать о фильме 'Интерстеллар'?").
### Семантический поиск:
Поиск релевантных рецензий по запросу в векторной базе данных. Пример функции: 

    semantic_search(client, "Лучшие фильмы 2023 года").
### Переформулирование запросов: 
Генерация нескольких вариантов запроса дл




я улучшения поиска.Пример функции: 

    rephrase_query(query="Расскажите о фильмах про космос").

## Пример использования

Исходные данные:

Входной запрос: Аудиофайл input_query.wav с просьбой рекомендации похожего фильма.

https://github.com/user-attachments/assets/2eacb0af-3b5f-433d-92bf-c7fd2549dbcb

Выходной ответ: Генерируется текстовый ответ с учетом запроса, множественногоперефразирования, контекста из базы данных отзывов и преобразуется в аудиофайл output_response.wav.

```python

input_query_path = "input_query.wav"
output_answer_path = "output_response.wav"

output_path = chat_with_audio_input(
    query_path=input_query_path,
    max_new_tokens=512,
    with_rephrase=True,  
    answer_file_path=output_answer_path
)

```



https://github.com/user-attachments/assets/3b25fe85-3629-4f08-9983-e2655ca574bd
